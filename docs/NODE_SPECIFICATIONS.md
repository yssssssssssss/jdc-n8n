# 节点设计能力和规范说明

本文档详细说明了工作流编辑器中各个节点的设计能力、规范和使用方法。

## 节点架构设计

### 基础节点组件 (CustomNode)

所有节点都基于 `CustomNode` 组件构建，提供统一的视觉风格和交互体验。

**核心特性：**
- 统一的圆角矩形设计
- 可配置的图标和颜色
- 动态输入/输出端口
- 悬停和选中状态效果
- 响应式布局

**技术规范：**
- 最小宽度：120px
- 最小高度：60px
- 边框圆角：8px
- 阴影效果：Material Design elevation 2

## 内置节点类型

### 1. 开始节点 (StartNode)

**设计规范：**
- **颜色主题：** `#4caf50` (Material Green 500)
- **图标：** PlayArrow (播放箭头)
- **端口配置：** 仅输出端口
- **用途：** 工作流的入口点

**功能能力：**
- 触发工作流执行
- 设置初始参数
- 定义工作流元数据

**使用规范：**
- 每个工作流必须有且仅有一个开始节点
- 不能有输入连接
- 必须至少有一个输出连接

### 2. 结束节点 (EndNode)

**设计规范：**
- **颜色主题：** `#f44336` (Material Red 500)
- **图标：** Stop (停止)
- **端口配置：** 仅输入端口
- **用途：** 工作流的终点

**功能能力：**
- 终止工作流执行
- 返回执行结果
- 记录执行状态

**使用规范：**
- 工作流可以有多个结束节点
- 不能有输出连接
- 必须至少有一个输入连接

### 3. 动作节点 (ActionNode)

**设计规范：**
- **颜色主题：** `#2196f3` (Material Blue 500)
- **图标：** Settings (设置齿轮)
- **端口配置：** 输入和输出端口
- **用途：** 执行具体的业务逻辑

**功能能力：**
- HTTP请求调用
- 数据转换处理
- 文件操作
- 数据库操作
- API集成
- 自定义脚本执行

**使用规范：**
- 必须配置具体的动作类型
- 支持参数配置和映射
- 可以有多个输入和输出
- 支持错误处理分支

### 4. 条件节点 (ConditionNode)

**设计规范：**
- **颜色主题：** `#ff9800` (Material Orange 500)
- **图标：** AccountTree (分支树)
- **端口配置：** 一个输入，多个输出
- **用途：** 流程分支控制

**功能能力：**
- 条件表达式评估
- 数据比较判断
- 逻辑运算
- 多分支路由

**使用规范：**
- 必须配置判断条件
- 支持多种比较操作符
- 至少需要两个输出分支
- 支持默认分支（else）

## 端口设计规范

### 端口类型

1. **默认端口 (default)**
   - 颜色：`#666666`
   - 用途：通用数据流
   - 位置：左侧输入，右侧输出

2. **成功端口 (success)**
   - 颜色：`#4caf50`
   - 用途：成功执行路径
   - 位置：右侧输出

3. **错误端口 (error)**
   - 颜色：`#f44336`
   - 用途：错误处理路径
   - 位置：右侧输出

4. **数据端口 (data)**
   - 颜色：`#2196f3`
   - 用途：数据传输
   - 位置：左右两侧

### 端口布局规则

- **输入端口：** 位于节点左侧
- **输出端口：** 位于节点右侧
- **端口间距：** 垂直间距20px
- **端口大小：** 直径8px
- **连接线：** 贝塞尔曲线，宽度2px

## 视觉设计规范

### 颜色系统

基于Material Design色彩规范：

- **主色调：** 各节点类型专用颜色
- **辅助色：** `#f5f5f5` (背景)
- **文本色：** `#333333` (主文本), `#666666` (辅助文本)
- **边框色：** `#e0e0e0` (默认), `#2196f3` (选中)

### 状态样式

1. **默认状态**
   - 背景：白色
   - 边框：1px solid #e0e0e0
   - 阴影：0 2px 4px rgba(0,0,0,0.1)

2. **悬停状态**
   - 阴影：0 4px 8px rgba(0,0,0,0.15)
   - 变换：translateY(-1px)

3. **选中状态**
   - 边框：2px solid #2196f3
   - 阴影：0 0 0 3px rgba(33,150,243,0.2)

4. **执行状态**
   - 边框：2px solid #ff9800
   - 动画：脉冲效果

### 图标规范

- **图标库：** Material-UI Icons
- **尺寸：** 24x24px
- **颜色：** 继承节点主题色
- **位置：** 节点左上角

## 交互设计规范

### 拖拽行为

1. **节点拖拽**
   - 从节点面板拖拽到画布
   - 拖拽时显示半透明预览
   - 释放时在鼠标位置创建节点

2. **连接拖拽**
   - 从输出端口拖拽到输入端口
   - 拖拽时显示连接线预览
   - 支持自动吸附到端口

### 选择行为

- **单击选择：** 选中单个节点
- **多选：** Ctrl+单击添加到选择
- **框选：** 拖拽选择多个节点
- **全选：** Ctrl+A选择所有节点

### 编辑行为

- **双击编辑：** 双击节点打开属性面板
- **右键菜单：** 复制、删除、属性等操作
- **键盘快捷键：** Delete删除、Ctrl+C复制等

## 数据流设计

### 数据传递机制

1. **节点数据结构**
   ```typescript
   interface NodeData {
     id: string;
     type: string;
     label: string;
     config: Record<string, any>;
     position: { x: number; y: number };
   }
   ```

2. **连接数据结构**
   ```typescript
   interface EdgeData {
     id: string;
     source: string;
     target: string;
     sourceHandle: string;
     targetHandle: string;
   }
   ```

### 执行流程

1. **初始化：** 从开始节点开始
2. **数据传递：** 通过连接线传递数据
3. **节点执行：** 按拓扑顺序执行
4. **分支处理：** 条件节点控制流向
5. **结束：** 到达结束节点完成

## 扩展性设计

### 自定义节点支持

- **插件机制：** 支持动态加载节点类型
- **配置驱动：** 通过配置文件定义节点
- **模板系统：** 提供节点模板快速创建

### 主题定制

- **颜色主题：** 支持深色/浅色主题切换
- **自定义色彩：** 允许用户自定义节点颜色
- **品牌定制：** 支持企业品牌色彩

## 性能优化

### 渲染优化

- **虚拟化：** 大量节点时使用虚拟滚动
- **懒加载：** 按需加载节点组件
- **缓存机制：** 缓存节点渲染结果

### 内存管理

- **对象池：** 复用节点对象
- **垃圾回收：** 及时清理无用引用
- **内存监控：** 监控内存使用情况

## 可访问性支持

### 键盘导航

- **Tab导航：** 支持键盘Tab切换
- **方向键：** 使用方向键移动选择
- **快捷键：** 提供常用操作快捷键

### 屏幕阅读器

- **ARIA标签：** 添加适当的ARIA属性
- **语义化：** 使用语义化HTML结构
- **焦点管理：** 合理管理焦点状态

## 测试规范

### 单元测试

- **组件测试：** 测试节点组件渲染
- **交互测试：** 测试拖拽、选择等交互
- **数据测试：** 测试数据传递和处理

### 集成测试

- **工作流测试：** 测试完整工作流执行
- **性能测试：** 测试大规模节点性能
- **兼容性测试：** 测试浏览器兼容性